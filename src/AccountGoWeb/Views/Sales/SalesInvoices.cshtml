@model string

<div class="w-full grid grid-cols-1 gap-4">
    <div class="flex gap-2 mb-4">
        <a href="~/sales/addsalesinvoice" class="px-4 py-2 bg-darkSecondary text-white rounded hover:bg-opacity-90">
            <i class="fa fa-plus"></i>
            New Invoice
        </a>
        <a href="~/sales/salesinvoice" id="linkEditInvoice" class="px-4 py-2 bg-gray-400 text-white rounded disabled">
            <i class="fa fa-edit"></i>
            Edit
        </a>
        <a href="~/sales/deletesalesinvoice" id="linkDeleteInvoice"
            class="px-4 py-2 bg-gray-400 text-white rounded disabled">
            <i class="fa fa-trash"></i>
            Delete
        </a>
    </div>
    <input type="hidden" id="hdnselectedsalesInvoiceId" />
    <div class="bg-white dark:bg-gray-800">
        <div id="salesinvoices" class="ag-fresh overflow-hidden rounded-lg shadow-md border-2 border-gray-200"
            style="height: 400px;"></div>
    </div>
</div>

@section scripts {
    <script>
        var columnDefs = [
            { headerName: "No", field: "no", width: 50 },
            { headerName: "Customer Name", field: "customerName", width: 200 },
            { headerName: "Invoiced Date", field: "invoiceDate", width: 250 },
            { headerName: "Amount", field: "amount", width: 100 },
            { headerName: "Ref no", field: "referenceNo", width: 100 },
            {
                headerName: "Posted", width: 100, cellRenderer: function (val) {
                    if (val.data.posted)
                        return '<input type="checkbox" checked disabled />';
                    return '<input type="checkbox" disabled />';
                }
            },
        ];

        var gridOptions = {
            columnDefs: columnDefs,
            rowData: @Html.Raw(Model),
            enableSorting: true,
            // PROPERTIES - simple boolean / string / number properties
            rowSelection: 'single',
            onSelectionChanged: onSelectionChanged,
        };

        function onSelectionChanged() {
            var selectedRows = gridOptions.api.getSelectedRows();
            var selectedRow = selectedRows[0];
            var hdnInput = document.getElementById('hdnselectedsalesInvoiceId');

            if (selectedRow && hdnInput) {
                hdnInput.value = selectedRow.id;
            }
        }

        // wait for the document to be loaded, otherwise
        // ag-Grid will not find the div in the document.
        document.addEventListener("DOMContentLoaded", function () {
            var eGridDiv = document.querySelector('#salesinvoices');
            new agGrid.Grid(eGridDiv, gridOptions);
        });


        function deleteSalesInvoice() {
            var salesInvoiceId = document.getElementById('hdnselectedsalesInvoiceId').value;
            if (salesInvoiceId) {
                location.href = '@Url.Action("DeleteSalesInvoice", "Sales")?id=' + salesInvoiceId;
            }
        }
    </script>
}
